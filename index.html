
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GlowBet Admin Panel</title>
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --success: #2ecc71;
      --danger: #e74c3c;
      --warning: #f39c12;
      --info: #17a2b8;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --gray: #95a5a6;
      --sidebar-width: 250px;
      --header-height: 70px;
    }

    body {
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #333;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Login Page */
    .admin-login {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
    }

    .login-container {
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      width: 100%;
      position: relative;
      overflow: hidden;
    }

    .login-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--secondary), var(--success));
    }

    .admin-logo {
      text-align: center;
      margin-bottom: 30px;
    }

    .admin-logo h1 {
      color: var(--primary);
      font-size: 32px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .admin-logo p {
      color: var(--gray);
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
    }

    .form-group input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s;
    }

    .form-group input:focus {
      border-color: var(--secondary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }

    .login-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--secondary), var(--info));
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
    }

    /* Dashboard Layout */
    .admin-dashboard {
      display: none;
      min-height: 100vh;
    }

    .admin-header {
      background: white;
      padding: 0 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: var(--header-height);
      position: fixed;
      top: 0;
      left: var(--sidebar-width);
      right: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .toggle-sidebar {
      background: none;
      border: none;
      font-size: 20px;
      color: var(--primary);
      cursor: pointer;
      display: none;
    }

    .admin-header h2 {
      color: var(--primary);
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--dark);
      font-weight: 500;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--secondary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .logout-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .logout-btn:hover {
      background: #c0392b;
      transform: translateY(-2px);
    }

    /* Sidebar */
    .admin-sidebar {
      width: var(--sidebar-width);
      background: var(--primary);
      color: white;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      overflow-y: auto;
      transition: all 0.3s;
      z-index: 101;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }

    .sidebar-header h3 {
      color: white;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .sidebar-menu {
      padding: 20px 0;
    }

    .menu-item {
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--light);
      text-decoration: none;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }

    .menu-item:hover, .menu-item.active {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border-left-color: var(--secondary);
    }

    .menu-item i {
      width: 20px;
      text-align: center;
    }

    .admin-content {
      margin-left: var(--sidebar-width);
      margin-top: var(--header-height);
      padding: 30px;
      transition: all 0.3s;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
      background: var(--secondary);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .stat-card.primary::before { background: var(--primary); }
    .stat-card.success::before { background: var(--success); }
    .stat-card.warning::before { background: var(--warning); }
    .stat-card.danger::before { background: var(--danger); }
    .stat-card.info::before { background: var(--info); }

    .stat-card h3 {
      color: var(--gray);
      font-size: 14px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stat-card .stat-value {
      color: var(--dark);
      font-size: 32px;
      font-weight: bold;
    }

    .stat-card .stat-change {
      font-size: 12px;
      margin-top: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .stat-card .stat-change.positive {
      color: var(--success);
    }

    .stat-card .stat-change.negative {
      color: var(--danger);
    }

    /* Section Cards */
    .section-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Game Control */
    .game-control {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .control-box {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #e0e0e0;
    }

    .control-label {
      font-weight: 600;
      margin-bottom: 10px;
      display: block;
      color: var(--dark);
    }

    .control-value {
      font-size: 24px;
      color: var(--primary);
      font-weight: bold;
      margin-bottom: 10px;
    }

    .number-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .number-btn {
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      text-align: center;
      transition: all 0.3s;
      background: white;
    }

    .number-btn:hover {
      transform: scale(1.05);
      border-color: var(--secondary);
    }

    .number-btn.selected {
      background: var(--secondary);
      color: white;
      border-color: var(--secondary);
    }

    .mode-toggle {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .mode-btn {
      flex: 1;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      background: white;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .mode-btn.active {
      background: var(--success);
      color: white;
      border-color: var(--success);
    }

    /* SCROLLABLE TABLE CONTAINER */
    .table-container {
      max-height: 400px;
      overflow-y: auto;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th,
    .data-table td {
      padding: 12px 8px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
      font-size: 14px;
    }

    .data-table th {
      background: #f8f9fa;
      font-weight: 600;
      color: var(--dark);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .data-table tr:hover {
      background: #f8f9fa;
    }

    .action-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      margin-right: 5px;
      margin-bottom: 5px;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .inspect-btn {
      background: var(--info);
      color: white;
    }

    .approve-btn {
      background: var(--success);
      color: white;
    }

    .reject-btn {
      background: var(--danger);
      color: white;
    }

    .delete-btn {
      background: var(--danger);
      color: white;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .status-badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-approved {
      background: #d4edda;
      color: #155724;
    }

    .status-rejected {
      background: #f8d7da;
      color: #721c24;
    }

    .status-active {
      background: #d4edda;
      color: #155724;
    }

    .status-banned {
      background: #f8d7da;
      color: #721c24;
    }

    .status-suspended {
      background: #fff3cd;
      color: #856404;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      overflow-y: auto;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      margin: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e0e0e0;
    }

    .modal-header h3 {
      color: var(--primary);
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .close-modal {
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      color: var(--gray);
      transition: all 0.3s;
    }

    .close-modal:hover {
      color: var(--dark);
      transform: rotate(90deg);
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .detail-row:last-child {
      border-bottom: none;
    }

    .detail-label {
      font-weight: 600;
      color: var(--gray);
    }

    .detail-value {
      color: var(--dark);
      font-weight: 500;
      text-align: right;
      max-width: 60%;
      word-wrap: break-word;
    }

    .modal-actions {
      margin-top: 25px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .modal-btn {
      flex: 1;
      min-width: 120px;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .modal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .ban-btn {
      background: var(--danger);
      color: white;
    }

    .suspend-btn {
      background: var(--warning);
      color: white;
    }

    .unban-btn {
      background: var(--success);
      color: white;
    }

    .adjust-btn {
      background: var(--info);
      color: white;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      padding: 20px 25px;
      border-radius: 10px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      z-index: 10000;
      display: none;
      min-width: 300px;
      border-left: 4px solid var(--success);
    }

    .notification.success {
      border-left-color: var(--success);
    }

    .notification.error {
      border-left-color: var(--danger);
    }

    .notification.warning {
      border-left-color: var(--warning);
    }

    .notification.info {
      border-left-color: var(--info);
    }

    .notification.show {
      display: block;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .hidden {
      display: none;
    }

    .results-scroll {
      max-height: 400px;
      overflow-y: auto;
    }

    .result-item {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .warning-message {
      background: #fff3cd;
      border: 2px solid var(--warning);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      color: #856404;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .success-message {
      background: #d4edda;
      border: 2px solid var(--success);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      color: #155724;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .input-group input {
      flex: 1;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }

    .input-group input:focus {
      border-color: var(--secondary);
      outline: none;
    }

    /* Gift Code Section */
    .gift-code-generator {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      border: 2px solid #e0e0e0;
    }

    .generate-btn {
      background: var(--success);
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .generate-btn:hover {
      background: #27ae60;
      transform: translateY(-2px);
    }

    .generated-code-display {
      background: #d4edda;
      border: 2px solid var(--success);
      padding: 20px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
      display: none;
    }

    .code-display-text {
      font-size: 24px;
      font-weight: bold;
      color: var(--success);
      margin: 10px 0;
      letter-spacing: 2px;
    }

    /* Gift Code List */
    .gift-code-list {
      margin-top: 20px;
    }

    .gift-code-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 4px solid var(--success);
    }

    .gift-code-info {
      flex: 1;
    }

    .gift-code-actions {
      display: flex;
      gap: 10px;
    }

    /* Betting Area */
    .bet-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid var(--info);
    }

    .bet-item-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .bet-item-detail {
      font-size: 14px;
      color: var(--gray);
      margin-top: 5px;
    }

    /* Responsive */
    @media (max-width: 992px) {
      .admin-sidebar {
        transform: translateX(-100%);
      }
      
      .admin-sidebar.active {
        transform: translateX(0);
      }
      
      .admin-content {
        margin-left: 0;
      }
      
      .admin-header {
        left: 0;
      }
      
      .toggle-sidebar {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .game-control {
        grid-template-columns: 1fr;
      }
      
      .modal-actions {
        flex-direction: column;
      }
      
      .modal-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <!-- Login Page -->
  <div class="admin-login" id="adminLogin">
    <div class="login-container">
      <div class="admin-logo">
        <h1><i class="fas fa-shield-alt"></i> Admin Panel</h1>
        <p>GlowBet Management System</p>
      </div>
      <div class="form-group">
        <label><i class="fas fa-phone"></i> Phone Number</label>
        <input type="tel" id="adminPhone" placeholder="Enter admin phone" value="9934406008" />
      </div>
      <div class="form-group">
        <label><i class="fas fa-lock"></i> Password</label>
        <input type="password" id="adminPassword" placeholder="Enter password" value="admin123" />
      </div>
      <button class="login-btn" onclick="adminLogin()"><i class="fas fa-sign-in-alt"></i> Login</button>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="admin-dashboard" id="adminDashboard">
    <!-- Sidebar -->
    <div class="admin-sidebar" id="adminSidebar">
      <div class="sidebar-header">
        <h3><i class="fas fa-crown"></i> GlowBet</h3>
      </div>
      <div class="sidebar-menu">
        <a href="#" class="menu-item active" data-section="dashboard">
          <i class="fas fa-tachometer-alt"></i> Dashboard
        </a>
        <a href="#" class="menu-item" data-section="gift-codes">
          <i class="fas fa-gift"></i> Gift Codes
        </a>
        <a href="#" class="menu-item" data-section="betting">
          <i class="fas fa-coins"></i> Live Betting
        </a>
        <a href="#" class="menu-item" data-section="game-control">
          <i class="fas fa-gamepad"></i> Game Control
        </a>
        <a href="#" class="menu-item" data-section="users">
          <i class="fas fa-users"></i> User Management
        </a>
        <a href="#" class="menu-item" data-section="deposits">
          <i class="fas fa-money-bill-wave"></i> Deposits
        </a>
        <a href="#" class="menu-item" data-section="withdrawals">
          <i class="fas fa-wallet"></i> Withdrawals
        </a>
      </div>
    </div>

    <!-- Header -->
    <div class="admin-header">
      <div class="header-left">
        <button class="toggle-sidebar" id="toggleSidebar">
          <i class="fas fa-bars"></i>
        </button>
        <h2><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h2>
      </div>
      <div class="header-right">
        <div class="user-info">
          <div class="user-avatar">A</div>
          <span>Admin</span>
        </div>
        <button class="logout-btn" onclick="adminLogout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>

    <!-- Content -->
    <div class="admin-content" id="adminContent">
      <!-- Dashboard Section -->
      <div class="content-section" id="dashboard-section">
        <!-- Statistics -->
        <div class="stats-grid">
          <div class="stat-card primary">
            <h3><i class="fas fa-users"></i> Total Users</h3>
            <div class="stat-value" id="totalUsers">0</div>
            <div class="stat-change positive">
              <i class="fas fa-arrow-up"></i> 12% from last week
            </div>
          </div>
          <div class="stat-card success">
            <h3><i class="fas fa-wallet"></i> Total Balance</h3>
            <div class="stat-value" id="totalBalance">‚Çπ0</div>
            <div class="stat-change positive">
              <i class="fas fa-arrow-up"></i> 8% from yesterday
            </div>
          </div>
          <div class="stat-card warning">
            <h3><i class="fas fa-money-bill-wave"></i> Pending Deposits</h3>
            <div class="stat-value" id="pendingDeposits">0</div>
            <div class="stat-change negative">
              <i class="fas fa-exclamation-circle"></i> Needs attention
            </div>
          </div>
          <div class="stat-card danger">
            <h3><i class="fas fa-wallet"></i> Pending Withdrawals</h3>
            <div class="stat-value" id="pendingWithdrawals">0</div>
            <div class="stat-change negative">
              <i class="fas fa-exclamation-circle"></i> Needs attention
            </div>
          </div>
          <div class="stat-card info">
            <h3><i class="fas fa-gift"></i> Active Gift Codes</h3>
            <div class="stat-value" id="activeGiftCodes">0</div>
            <div class="stat-change positive">
              <i class="fas fa-arrow-up"></i> 5 new today
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="section-card">
          <div class="section-title"><i class="fas fa-bolt"></i> Quick Actions</div>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <button class="action-btn inspect-btn" onclick="showSection('gift-codes')">
              <i class="fas fa-gift"></i> Create Gift Code
            </button>
            <button class="action-btn approve-btn" onclick="showSection('withdrawals')">
              <i class="fas fa-wallet"></i> Process Withdrawals
            </button>
            <button class="action-btn inspect-btn" onclick="showSection('deposits')">
              <i class="fas fa-money-bill-wave"></i> Review Deposits
            </button>
            <button class="action-btn inspect-btn" onclick="showSection('game-control')">
              <i class="fas fa-gamepad"></i> Game Settings
            </button>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="section-card">
          <div class="section-title"><i class="fas fa-history"></i> Recent Activity</div>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>User</th>
                  <th>Action</th>
                  <th>Details</th>
                </tr>
              </thead>
              <tbody id="recentActivityBody">
                <tr>
                  <td colspan="4" style="text-align: center; padding: 20px;">Loading activity...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Gift Codes Section -->
      <div class="content-section hidden" id="gift-codes-section">
        <div class="section-card">
          <div class="section-title"><i class="fas fa-gift"></i> Gift Code Management</div>
          <div class="gift-code-generator">
            <div class="form-group">
              <label>Gift Code Name/ID</label>
              <input type="text" id="giftCodeName" placeholder="e.g., WELCOME100" />
            </div>
            <div class="form-group">
              <label>Gift Amount (‚Çπ)</label>
              <input type="number" id="giftCodeAmount" placeholder="Enter amount" min="1" />
            </div>
            <div class="form-group">
              <label>Max Users (0 = unlimited)</label>
              <input type="number" id="giftCodeMaxUsers" placeholder="Max users" min="0" value="0" />
            </div>
            <button class="generate-btn" onclick="generateGiftCode()">
              <i class="fas fa-plus-circle"></i> Generate Gift Code
            </button>
            <div class="generated-code-display" id="generatedCodeDisplay">
              <p><i class="fas fa-check-circle"></i> Gift Code Generated Successfully!</p>
              <div class="code-display-text" id="displayGeneratedCode">XXXX-XXXX</div>
              <p style="color: #666; margin-top: 10px;">Share this code with users</p>
            </div>
          </div>

          <!-- Gift Code List -->
          <div class="gift-code-list">
            <h4 style="margin: 20px 0 10px; color: var(--dark);">Active Gift Codes</h4>
            <div id="giftCodeList">
              <p style="text-align: center; color: #999; padding: 20px;">Loading gift codes...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Betting Section -->
      <div class="content-section hidden" id="betting-section">
        <div class="section-card">
          <div class="section-title"><i class="fas fa-coins"></i> Live Betting Activity</div>
          <div class="table-container">
            <div id="liveBettingArea">
              <p style="text-align: center; color: #999; padding: 20px;">Waiting for bets...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Game Control Section -->
      <div class="content-section hidden" id="game-control-section">
        <div class="section-card">
          <div class="section-title"><i class="fas fa-gamepad"></i> Game Control System</div>
          <div class="game-control">
            <div class="control-box">
              <span class="control-label">Current Period</span>
              <div class="control-value" id="adminCurrentPeriod">Loading...</div>
            </div>
            <div class="control-box">
              <span class="control-label">Time Left</span>
              <div class="control-value" id="adminTimeLeft">60s</div>
            </div>
          </div>

          <div style="margin-top: 30px;">
            <h4 style="margin-bottom: 15px; color: var(--dark);">Game Mode Control</h4>
            <div class="mode-toggle">
              <button class="mode-btn active" id="autoModeBtn" onclick="setGameMode('auto')">
                <i class="fas fa-robot"></i> Auto Mode
              </button>
              <button class="mode-btn" id="manualModeBtn" onclick="setGameMode('manual')">
                <i class="fas fa-user"></i> Manual Mode
              </button>
            </div>
            
            <div id="manualControl" class="hidden">
              <div class="warning-message">
                <i class="fas fa-exclamation-triangle"></i> 
                <div>
                  <strong>Manual Mode Active:</strong> Select a number below. It will be published immediately when the timer reaches 0 seconds.
                </div>
              </div>
              <p style="margin: 15px 0; color: var(--gray);">Select winning number for next round:</p>
              <div class="number-grid">
                <div class="number-btn" onclick="selectWinningNumber(0)">0</div>
                <div class="number-btn" onclick="selectWinningNumber(1)">1</div>
                <div class="number-btn" onclick="selectWinningNumber(2)">2</div>
                <div class="number-btn" onclick="selectWinningNumber(3)">3</div>
                <div class="number-btn" onclick="selectWinningNumber(4)">4</div>
                <div class="number-btn" onclick="selectWinningNumber(5)">5</div>
                <div class="number-btn" onclick="selectWinningNumber(6)">6</div>
                <div class="number-btn" onclick="selectWinningNumber(7)">7</div>
                <div class="number-btn" onclick="selectWinningNumber(8)">8</div>
                <div class="number-btn" onclick="selectWinningNumber(9)">9</div>
              </div>
              <div id="selectedNumberDisplay" class="success-message" style="display: none;">
                <i class="fas fa-check-circle"></i>
                <div>
                  Selected Number: <strong><span id="selectedNumText">-</span></strong> - Will auto-publish at 0 seconds
                </div>
              </div>
            </div>
          </div>

          <div style="margin-top: 30px;">
            <h4 style="margin-bottom: 15px; color: var(--dark);">Recent Results (Last 20)</h4>
            <div class="results-scroll" id="recentResults">Loading...</div>
          </div>
        </div>
      </div>

      <!-- User Management Section -->
      <div class="content-section hidden" id="users-section">
        <div class="section-card">
          <div class="section-title"><i class="fas fa-users"></i> User Management</div>
          <div class="table-container">
            <table class="data-table" id="usersTable">
              <thead>
                <tr>
                  <th style="width: 15%;">User Number</th>
                  <th style="width: 25%;">Phone Number</th>
                  <th style="width: 15%;">Status</th>
                  <th style="width: 45%;">Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <tr><td colspan="4" style="text-align: center; padding: 20px;">Loading users...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Deposits Section -->
      <div class="content-section hidden" id="deposits-section">
        <div class="section-card">
          <div class="section-title"><i class="fas fa-money-bill-wave"></i> Deposit Requests</div>
          <div class="table-container">
            <table class="data-table" id="depositsTable">
              <thead>
                <tr>
                  <th style="width: 15%;">User Number</th>
                  <th style="width: 20%;">Phone Number</th>
                  <th style="width: 15%;">Amount</th>
                  <th style="width: 15%;">Status</th>
                  <th style="width: 35%;">Actions</th>
                </tr>
              </thead>
              <tbody id="depositsTableBody">
                <tr><td colspan="5" style="text-align: center; padding: 20px;">No deposits yet</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Withdrawals Section -->
      <div class="content-section hidden" id="withdrawals-section">
        <div class="section-card">
          <div class="section-title"><i class="fas fa-wallet"></i> Withdrawal Requests</div>
          <div class="table-container">
            <table class="data-table" id="withdrawalsTable">
              <thead>
                <tr>
                  <th style="width: 15%;">User Number</th>
                  <th style="width: 20%;">Phone Number</th>
                  <th style="width: 15%;">Amount</th>
                  <th style="width: 15%;">Status</th>
                  <th style="width: 35%;">Actions</th>
                </tr>
              </thead>
              <tbody id="withdrawalsTableBody">
                <tr><td colspan="5" style="text-align: center; padding: 20px;">No withdrawals yet</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- User Inspect Modal -->
  <div class="modal" id="userInspectModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-user"></i> User Details</h3>
        <span class="close-modal" onclick="closeUserModal()">&times;</span>
      </div>
      <div id="userModalContent"></div>
      <div class="modal-actions" id="userModalActions"></div>
    </div>
  </div>

  <!-- Deposit Inspect Modal -->
  <div class="modal" id="depositInspectModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-money-bill-wave"></i> Deposit Details</h3>
        <span class="close-modal" onclick="closeDepositModal()">&times;</span>
      </div>
      <div id="depositModalContent"></div>
      <div class="modal-actions" id="depositModalActions"></div>
    </div>
  </div>

  <!-- Withdrawal Inspect Modal -->
  <div class="modal" id="withdrawalInspectModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-wallet"></i> Withdrawal Details</h3>
        <span class="close-modal" onclick="closeWithdrawalModal()">&times;</span>
      </div>
      <div id="withdrawalModalContent"></div>
      <div class="modal-actions" id="withdrawalModalActions"></div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">
    <div id="notificationMessage"></div>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCAHzv-VxvatsG9CFsCzbrNx9X6uaKRAa4",
      authDomain: "glowbet-1b2ce.firebaseapp.com",
      databaseURL: "https://glowbet-1b2ce-default-rtdb.firebaseio.com/",
      projectId: "glowbet-1b2ce",
      storageBucket: "glowbet-1b2ce.firebasestorage.app",
      messagingSenderId: "333266810255",
      appId: "1:333266810255:web:877010652ce46c8af687fa",
      measurementId: "G-53QM377N5M"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const ADMIN_CREDS = {
      phone: '9934406008',
      password: 'admin123'
    };

    let gameMode = 'auto';
    let selectedNumber = null;
    let adminCountdown = 60;
    let adminCountdownInterval = null;
    let currentAdminPeriod = null;
    let resultPublished = false;
    let userNumberMap = {};

    // USER NUMBER MAPPING
    function generateUserNumber(userId) {
      if (!userNumberMap[userId]) {
        const existingNumbers = Object.values(userNumberMap);
        let newNumber = 1;
        while (existingNumbers.includes(newNumber)) {
          newNumber++;
        }
        userNumberMap[userId] = newNumber;
        database.ref('user_numbers/' + userId).set(newNumber);
      }
      return userNumberMap[userId];
    }

    function loadUserNumbers() {
      database.ref('user_numbers').once('value').then(snapshot => {
        userNumberMap = snapshot.val() || {};
      });
    }

    // ‚ö†Ô∏è FIX: TIMESTAMP-BASED PERIOD (NO SKIPPING)
    function generateCurrentPeriod() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const minutesSinceMidnight = Math.floor((now.getHours() * 60 + now.getMinutes()));
      const periodNumber = minutesSinceMidnight + 1;
      return `${year}${month}${day}${String(periodNumber).padStart(4, '0')}`;
    }

    function getPeriodStartTime(period) {
      const year = parseInt(period.substring(0, 4));
      const month = parseInt(period.substring(4, 6)) - 1;
      const day = parseInt(period.substring(6, 8));
      const periodNum = parseInt(period.substring(8, 12));
      
      const date = new Date(year, month, day);
      date.setHours(0, 0, 0, 0);
      return date.getTime() + ((periodNum - 1) * 60 * 1000);
    }

    function getTimeLeftInPeriod() {
      const now = Date.now();
      const startTime = getPeriodStartTime(currentAdminPeriod);
      const elapsed = now - startTime;
      const remaining = 60000 - (elapsed % 60000);
      return Math.floor(remaining / 1000);
    }

    // Login
    function adminLogin() {
      const phone = document.getElementById('adminPhone').value;
      const password = document.getElementById('adminPassword').value;

      if (phone === ADMIN_CREDS.phone && password === ADMIN_CREDS.password) {
        document.getElementById('adminLogin').style.display = 'none';
        document.getElementById('adminDashboard').style.display = 'block';
        loadUserNumbers();
        loadDashboardData();
        startAdminTimer();
        listenToLiveBets();
        showNotification('success', 'Admin login successful!');
      } else {
        showNotification('error', 'Invalid credentials!');
      }
    }

    function adminLogout() {
      clearInterval(adminCountdownInterval);
      document.getElementById('adminDashboard').style.display = 'none';
      document.getElementById('adminLogin').style.display = 'flex';
      document.getElementById('adminPhone').value = '';
      document.getElementById('adminPassword').value = '';
    }

    // Sidebar Toggle
    document.getElementById('toggleSidebar').addEventListener('click', function() {
      document.getElementById('adminSidebar').classList.toggle('active');
    });

    // Section Navigation
    function showSection(sectionName) {
      // Hide all sections
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Show selected section
      document.getElementById(sectionName + '-section').classList.remove('hidden');
      
      // Update active menu item
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-section') === sectionName) {
          item.classList.add('active');
        }
      });
    }

    // Add event listeners to menu items
    document.querySelectorAll('.menu-item').forEach(item => {
      item.addEventListener('click', function(e) {
        e.preventDefault();
        const section = this.getAttribute('data-section');
        showSection(section);
        
        // Close sidebar on mobile after selection
        if (window.innerWidth <= 992) {
          document.getElementById('adminSidebar').classList.remove('active');
        }
      });
    });

    // Load Dashboard
    function loadDashboardData() {
      loadStats();
      loadUsers();
      loadDeposits();
      loadWithdrawals();
      loadRecentResults();
      loadGiftCodes();
      updateGameControl();
      loadRecentActivity();
    }

    function loadStats() {
      database.ref('users').once('value').then(snapshot => {
        const users = snapshot.val() || {};
        const userCount = Object.keys(users).length;
        let totalBalance = 0;
        
        Object.values(users).forEach(user => {
          totalBalance += user.balance || 0;
        });

        document.getElementById('totalUsers').textContent = userCount;
        document.getElementById('totalBalance').textContent = `‚Çπ${totalBalance.toFixed(2)}`;
      });

      database.ref('deposits').orderByChild('status').equalTo('pending').once('value').then(snapshot => {
        const count = snapshot.numChildren();
        document.getElementById('pendingDeposits').textContent = count;
      });

      database.ref('withdrawals').orderByChild('status').equalTo('pending').once('value').then(snapshot => {
        const count = snapshot.numChildren();
        document.getElementById('pendingWithdrawals').textContent = count;
      });

      database.ref('gift_codes').orderByChild('status').equalTo('active').once('value').then(snapshot => {
        const count = snapshot.numChildren();
        document.getElementById('activeGiftCodes').textContent = count;
      });
    }

    // Recent Activity
    function loadRecentActivity() {
      const activityBody = document.getElementById('recentActivityBody');
      activityBody.innerHTML = '';
      
      // Get recent deposits
      database.ref('deposits').orderByChild('timestamp').limitToLast(5).once('value').then(snapshot => {
        const deposits = [];
        snapshot.forEach(child => {
          deposits.push(child.val());
        });
        
        deposits.sort((a, b) => b.timestamp - a.timestamp);
        
        deposits.forEach(deposit => {
          const userNumber = generateUserNumber(deposit.userId);
          const row = document.createElement('tr');
          const time = new Date(deposit.timestamp).toLocaleTimeString();
          
          row.innerHTML = `
            <td>${time}</td>
            <td>User #${userNumber}</td>
            <td>Deposit Request</td>
            <td>‚Çπ${deposit.amount} - ${deposit.status}</td>
          `;
          
          activityBody.appendChild(row);
        });
      });
      
      // Get recent withdrawals
      database.ref('withdrawals').orderByChild('timestamp').limitToLast(5).once('value').then(snapshot => {
        const withdrawals = [];
        snapshot.forEach(child => {
          withdrawals.push(child.val());
        });
        
        withdrawals.sort((a, b) => b.timestamp - a.timestamp);
        
        withdrawals.forEach(withdrawal => {
          const userNumber = generateUserNumber(withdrawal.userId);
          const row = document.createElement('tr');
          const time = new Date(withdrawal.timestamp).toLocaleTimeString();
          
          row.innerHTML = `
            <td>${time}</td>
            <td>User #${userNumber}</td>
            <td>Withdrawal Request</td>
            <td>‚Çπ${withdrawal.amount} - ${withdrawal.status}</td>
          `;
          
          activityBody.appendChild(row);
        });
      });
    }

    // ‚ö†Ô∏è FIX: GIFT CODE GENERATOR (FIXED STRUCTURE)
    function generateGiftCode() {
      const codeName = document.getElementById('giftCodeName').value.trim();
      const amount = parseFloat(document.getElementById('giftCodeAmount').value);
      const maxUsers = parseInt(document.getElementById('giftCodeMaxUsers').value);

      if (!codeName || !amount || amount <= 0) {
        showNotification('error', 'Please fill all fields with valid data');
        return;
      }

      const giftCode = codeName.toUpperCase().replace(/\s+/g, '_');
      const giftData = {
        code: giftCode,
        amount: amount,
        maxUsers: maxUsers,
        usedCount: 0,
        createdAt: Date.now(),
        status: 'active',
        usedBy: null,
        usedAt: null
      };

      database.ref('gift_codes/' + giftCode).set(giftData)
        .then(() => {
          document.getElementById('displayGeneratedCode').textContent = giftCode;
          document.getElementById('generatedCodeDisplay').style.display = 'block';
          showNotification('success', `Gift code "${giftCode}" created with ‚Çπ${amount}`);
          
          document.getElementById('giftCodeName').value = '';
          document.getElementById('giftCodeAmount').value = '';
          document.getElementById('giftCodeMaxUsers').value = '0';
          
          loadGiftCodes();
        })
        .catch(error => {
          console.error('Error creating gift code:', error);
          showNotification('error', 'Failed to create gift code');
        });
    }

    // ‚ö†Ô∏è FIX: GIFT CODE LIST MANAGEMENT
    function loadGiftCodes() {
      const giftCodeList = document.getElementById('giftCodeList');
      giftCodeList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Loading gift codes...</p>';

      database.ref('gift_codes').orderByChild('createdAt').once('value')
        .then(snapshot => {
          giftCodeList.innerHTML = '';
          
          if (!snapshot.exists()) {
            giftCodeList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No gift codes created yet</p>';
            return;
          }

          const giftCodes = [];
          snapshot.forEach(childSnapshot => {
            giftCodes.push(childSnapshot.val());
          });

          giftCodes.sort((a, b) => b.createdAt - a.createdAt);

          giftCodes.forEach(gift => {
            const item = document.createElement('div');
            item.className = 'gift-code-item';
            
            const statusText = gift.status === 'active' ? 'Active' : 'Used';
            const statusColor = gift.status === 'active' ? '#00a86b' : '#999';
            
            item.innerHTML = `
              <div class="gift-code-info">
                <div style="font-weight: bold; font-size: 16px;">${gift.code}</div>
                <div style="color: #666; margin-top: 5px;">
                  Amount: ‚Çπ${gift.amount} | 
                  Used: ${gift.usedCount || 0}${gift.maxUsers > 0 ? ` / ${gift.maxUsers}` : ''} | 
                  Status: <span style="color: ${statusColor}">${statusText}</span>
                </div>
              </div>
              <div class="gift-code-actions">
                <button class="action-btn delete-btn" onclick="deleteGiftCode('${gift.code}')">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            `;
            
            giftCodeList.appendChild(item);
          });
        })
        .catch(error => {
          console.error('Error loading gift codes:', error);
          giftCodeList.innerHTML = '<p style="text-align: center; color: #ff4444; padding: 20px;">Failed to load gift codes</p>';
        });
    }

    // ‚ö†Ô∏è FIX: DELETE GIFT CODE FUNCTION
    function deleteGiftCode(code) {
      if (confirm(`Are you sure you want to delete gift code "${code}"?`)) {
        database.ref('gift_codes/' + code).remove()
          .then(() => {
            showNotification('success', `Gift code "${code}" deleted successfully!`);
            loadGiftCodes();
            loadStats();
          })
          .catch(error => {
            console.error('Error deleting gift code:', error);
            showNotification('error', 'Failed to delete gift code');
          });
      }
    }

    // üí∞ LIVE BETTING AREA (USER NUMBER DISPLAY)
    function listenToLiveBets() {
      database.ref('bets').limitToLast(5).on('value', snapshot => {
        const betsContainer = document.getElementById('liveBettingArea');
        betsContainer.innerHTML = '';

        if (!snapshot.exists()) {
          betsContainer.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No bets yet</p>';
          return;
        }

        const bets = [];
        snapshot.forEach(childSnapshot => {
          const roundBets = childSnapshot.val();
          Object.values(roundBets).forEach(bet => {
            if (bet.status === 'pending') {
              bets.push(bet);
            }
          });
        });

        bets.slice(-5).reverse().forEach(bet => {
          const userNumber = generateUserNumber(bet.userId);
          const betItem = document.createElement('div');
          betItem.className = 'bet-item';
          
          const selectionDisplay = typeof bet.selection === 'number' ? 
            `Number ${bet.selection}` : 
            bet.selection.toUpperCase();

          betItem.innerHTML = `
            <div class="bet-item-header">
              <span><i class="fas fa-user"></i> User #${userNumber}</span>
              <span style="color: #00a86b; font-weight: bold;">‚Çπ${bet.amount}</span>
            </div>
            <div class="bet-item-detail">
              <strong>Bet:</strong> ${selectionDisplay} | 
              <strong>Round:</strong> ${bet.roundId.slice(-4)} |
              <strong>Time:</strong> ${new Date(bet.timestamp).toLocaleTimeString()}
            </div>
          `;
          betsContainer.appendChild(betItem);
        });
      });
    }

    // User Management
    function loadUsers() {
      database.ref('users').on('value', snapshot => {
        const users = snapshot.val() || {};
        const tbody = document.getElementById('usersTableBody');
        tbody.innerHTML = '';

        if (Object.keys(users).length === 0) {
          tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px;">No users yet</td></tr>';
          return;
        }

        Object.entries(users).forEach(([key, user]) => {
          const row = document.createElement('tr');
          const status = user.status || 'active';
          const userNumber = generateUserNumber(user.userId);
          
          let statusBadgeClass = 'status-active';
          let statusText = 'ACTIVE';
          if (status === 'banned') {
            statusBadgeClass = 'status-banned';
            statusText = 'BANNED';
          } else if (status === 'suspended') {
            statusBadgeClass = 'status-suspended';
            statusText = 'SUSPENDED';
          }
          
          row.innerHTML = `
            <td><strong>#${userNumber}</strong></td>
            <td><strong>${user.phone}</strong></td>
            <td><span class="status-badge ${statusBadgeClass}">${statusText}</span></td>
            <td>
              <button class="action-btn inspect-btn" onclick="inspectUser('${key}')">
                <i class="fas fa-search"></i> Inspect
              </button>
            </td>
          `;
          tbody.appendChild(row);
        });
      });
    }

    function inspectUser(userKey) {
      database.ref('users/' + userKey).once('value').then(snapshot => {
        const user = snapshot.val();
        const regDate = user.registeredDate ? new Date(user.registeredDate).toLocaleString() : 'N/A';
        const status = user.status || 'active';
        const userNumber = generateUserNumber(user.userId);
        
        let suspendInfo = '';
        if (status === 'suspended' && user.unsuspendAt) {
          const timeLeft = user.unsuspendAt - Date.now();
          const hoursLeft = Math.ceil(timeLeft / (1000 * 60 * 60));
          suspendInfo = `<div class="detail-row">
            <span class="detail-label">Suspend Expires In:</span>
            <span class="detail-value" style="color: #ff9800; font-weight: bold;">${hoursLeft} hours</span>
          </div>`;
        }
        
        const modalContent = document.getElementById('userModalContent');
        modalContent.innerHTML = `
          <div class="detail-row">
            <span class="detail-label">User Number:</span>
            <span class="detail-value" style="font-weight: bold; color: #1e3c72;">#${userNumber}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">User ID:</span>
            <span class="detail-value">${user.userId || 'N/A'}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Phone:</span>
            <span class="detail-value">${user.phone}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Password:</span>
            <span class="detail-value">${user.password}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Registered Date:</span>
            <span class="detail-value">${regDate}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Status:</span>
            <span class="detail-value" style="color: ${status === 'active' ? '#00a86b' : '#ff4444'}; font-weight: bold;">${status.toUpperCase()}</span>
          </div>
          ${suspendInfo}
          <div class="detail-row">
            <span class="detail-label">Balance:</span>
            <span class="detail-value" style="color: #00a86b; font-weight: bold;">‚Çπ${(user.balance || 0).toFixed(2)}</span>
          </div>
          ${user.bankDetails ? `
            <div class="detail-row">
              <span class="detail-label">Account Number:</span>
              <span class="detail-value">${user.bankDetails.accNumber}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">IFSC Code:</span>
              <span class="detail-value">${user.bankDetails.ifsc}</span>
            </div>
          ` : '<p style="text-align: center; color: #999; margin-top: 10px;">No bank details saved</p>'}
        `;

        const modalActions = document.getElementById('userModalActions');
        modalActions.innerHTML = `
          <button class="modal-btn adjust-btn" onclick="adjustBalance('${userKey}')">
            <i class="fas fa-wallet"></i> Adjust Balance
          </button>
          ${status === 'active' ? `
            <button class="modal-btn suspend-btn" onclick="suspendUserModal('${userKey}')">
              <i class="fas fa-pause"></i> Suspend
            </button>
            <button class="modal-btn ban-btn" onclick="banUserModal('${userKey}')">
              <i class="fas fa-ban"></i> Ban
            </button>
          ` : `
            <button class="modal-btn unban-btn" onclick="unbanUserModal('${userKey}')">
              <i class="fas fa-check"></i> Unban/Unsuspend
            </button>
          `}
        `;
        
        document.getElementById('userInspectModal').style.display = 'flex';
      });
    }

    function closeUserModal() {
      document.getElementById('userInspectModal').style.display = 'none';
    }

    function banUserModal(userKey) {
      if (!confirm('Are you sure you want to BAN this user permanently?')) {
        return;
      }
      
      database.ref('users/' + userKey + '/status').set('banned')
        .then(() => {
          showNotification('success', 'User has been banned');
          closeUserModal();
          loadStats();
        })
        .catch(error => {
          console.error('Error:', error);
          showNotification('error', 'Failed to ban user');
        });
    }

    function suspendUserModal(userKey) {
      const hours = prompt('Suspend for how many hours?');
      if (!hours || isNaN(hours) || hours <= 0) {
        showNotification('error', 'Invalid number of hours');
        return;
      }
      
      const unsuspendAt = Date.now() + (parseInt(hours) * 60 * 60 * 1000);
      
      database.ref('users/' + userKey).update({
        status: 'suspended',
        unsuspendAt: unsuspendAt
      })
        .then(() => {
          showNotification('success', `User suspended for ${hours} hours`);
          closeUserModal();
          loadStats();
        })
        .catch(error => {
          console.error('Error:', error);
          showNotification('error', 'Failed to suspend user');
        });
    }

    function unbanUserModal(userKey) {
      if (!confirm('Are you sure you want to UNBAN/UNSUSPEND this user?')) {
        return;
      }
      
      database.ref('users/' + userKey).update({
        status: 'active',
        unsuspendAt: null
      })
        .then(() => {
          showNotification('success', 'User has been unbanned/unsuspended');
          closeUserModal();
          loadStats();
        })
        .catch(error => {
          console.error('Error:', error);
          showNotification('error', 'Failed to unban user');
        });
    }

    function adjustBalance(userKey) {
      const amount = prompt('Enter amount to add (use negative for deduction):');
      if (amount) {
        const adjustAmount = parseFloat(amount);
        database.ref('users/' + userKey).once('value').then(snapshot => {
          const user = snapshot.val();
          const newBalance = Math.max(0, (user.balance || 0) + adjustAmount);
          database.ref('users/' + userKey + '/balance').set(newBalance)
            .then(() => {
              showNotification('success', `Balance adjusted by ‚Çπ${adjustAmount}`);
              closeUserModal();
              loadStats();
            });
        });
      }
    }

    // Deposits (WITH USER NUMBER)
    function loadDeposits() {
      database.ref('deposits').on('value', snapshot => {
        const deposits = snapshot.val() || {};
        const tbody = document.getElementById('depositsTableBody');
        tbody.innerHTML = '';

        const depositArray = Object.entries(deposits).sort((a, b) => b[1].timestamp - a[1].timestamp);

        if (depositArray.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">No deposits yet</td></tr>';
          return;
        }

        depositArray.forEach(([key, deposit]) => {
          const row = document.createElement('tr');
          const statusClass = deposit.status === 'pending' ? 'status-pending' : 
                             deposit.status === 'approved' ? 'status-approved' : 'status-rejected';
          const userNumber = generateUserNumber(deposit.userId);
          
          row.innerHTML = `
            <td><strong>#${userNumber}</strong></td>
            <td><strong>${deposit.phone}</strong></td>
            <td>‚Çπ${deposit.amount}</td>
            <td><span class="status-badge ${statusClass}">${deposit.status.toUpperCase()}</span></td>
            <td>
              <button class="action-btn inspect-btn" onclick="inspectDeposit('${key}')">
                <i class="fas fa-search"></i> Inspect
              </button>
              <button class="action-btn delete-btn" onclick="deleteDepositAdmin('${key}')">
                <i class="fas fa-trash"></i> Delete
              </button>
            </td>
          `;
          tbody.appendChild(row);
        });
      });
    }

    function inspectDeposit(depositKey) {
      database.ref('deposits/' + depositKey).once('value').then(snapshot => {
        const deposit = snapshot.val();
        const date = new Date(deposit.timestamp).toLocaleString();
        const userNumber = generateUserNumber(deposit.userId);
        
        const modalContent = document.getElementById('depositModalContent');
        modalContent.innerHTML = `
          <div class="detail-row">
            <span class="detail-label">User Number:</span>
            <span class="detail-value" style="font-weight: bold; color: #1e3c72;">#${userNumber}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Deposit ID:</span>
            <span class="detail-value">${deposit.depositId}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">User ID:</span>
            <span class="detail-value">${deposit.userId}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Phone:</span>
            <span class="detail-value">${deposit.phone}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Amount:</span>
            <span class="detail-value" style="color: #00a86b; font-weight: bold;">‚Çπ${deposit.amount}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">UTR Number:</span>
            <span class="detail-value">${deposit.utr}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Date & Time:</span>
            <span class="detail-value">${date}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Status:</span>
            <span class="detail-value" style="color: ${deposit.status === 'approved' ? '#00a86b' : deposit.status === 'rejected' ? '#ff4444' : '#ff9800'}">
              ${deposit.status.toUpperCase()}
            </span>
          </div>
        `;

        const modalActions = document.getElementById('depositModalActions');
        if (deposit.status === 'pending') {
          modalActions.innerHTML = `
            <button class="modal-btn approve-btn" onclick="approveDepositModal('${depositKey}')">
              <i class="fas fa-check"></i> Approve
            </button>
            <button class="modal-btn reject-btn" onclick="rejectDepositModal('${depositKey}')">
              <i class="fas fa-times"></i> Reject
            </button>
          `;
        } else {
          modalActions.innerHTML = '<p style="text-align: center; color: #999;">No actions available</p>';
        }
        
        document.getElementById('depositInspectModal').style.display = 'flex';
      });
    }

    function closeDepositModal() {
      document.getElementById('depositInspectModal').style.display = 'none';
    }

    function approveDepositModal(depositKey) {
      database.ref('deposits/' + depositKey).once('value').then(snapshot => {
        const deposit = snapshot.val();
        
        database.ref('deposits/' + depositKey + '/status').set('approved');
        
        const cleanPhone = deposit.phone.replace(/[^0-9]/g, '');
        database.ref('users/' + cleanPhone).once('value').then(userSnapshot => {
          const user = userSnapshot.val();
          const newBalance = (user.balance || 0) + deposit.amount;
          database.ref('users/' + cleanPhone + '/balance').set(newBalance);
          
          showNotification('success', `Deposit approved: ‚Çπ${deposit.amount}`);
          closeDepositModal();
          loadStats();
        });
      });
    }

    function rejectDepositModal(depositKey) {
      if (!confirm('Are you sure you want to REJECT this deposit?')) return;
      
      database.ref('deposits/' + depositKey + '/status').set('rejected')
        .then(() => {
          showNotification('success', 'Deposit rejected');
          closeDepositModal();
        });
    }

    // ‚ö†Ô∏è FIX: DELETE DEPOSIT FROM ADMIN
    function deleteDepositAdmin(depositKey) {
      if (confirm("Are you sure you want to delete this deposit record?")) {
        database.ref('deposits/' + depositKey).remove()
          .then(() => {
            showNotification('success', "Deposit record deleted successfully!");
            loadDeposits();
          })
          .catch(error => {
            console.error("Error deleting deposit:", error);
            showNotification('error', "Failed to delete deposit record");
          });
      }
    }

    // ‚úÖ FIXED: Withdrawals (WITH FULL INSPECT MODAL DETAILS)
    function loadWithdrawals() {
      database.ref('withdrawals').on('value', snapshot => {
        const withdrawals = snapshot.val() || {};
        const tbody = document.getElementById('withdrawalsTableBody');
        tbody.innerHTML = '';

        const withdrawalArray = Object.entries(withdrawals).sort((a, b) => b[1].timestamp - a[1].timestamp);

        if (withdrawalArray.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">No withdrawals yet</td></tr>';
          return;
        }

        withdrawalArray.forEach(([key, withdrawal]) => {
          const row = document.createElement('tr');
          const statusClass = withdrawal.status === 'pending' ? 'status-pending' : 
                             withdrawal.status === 'approved' ? 'status-approved' : 'status-rejected';
          const userNumber = generateUserNumber(withdrawal.userId);
          
          row.innerHTML = `
            <td><strong>#${userNumber}</strong></td>
            <td><strong>${withdrawal.phone}</strong></td>
            <td>‚Çπ${withdrawal.amount}</td>
            <td><span class="status-badge ${statusClass}">${withdrawal.status.toUpperCase()}</span></td>
            <td>
              <button class="action-btn inspect-btn" onclick="inspectWithdrawal('${key}')">
                <i class="fas fa-search"></i> Inspect
              </button>
              <button class="action-btn delete-btn" onclick="deleteWithdrawalAdmin('${key}')">
                <i class="fas fa-trash"></i> Delete
              </button>
            </td>
          `;
          tbody.appendChild(row);
        });
      });
    }

    // ‚úÖ FIXED: inspectWithdrawal - NOW SHOWS ALL DETAILS INCLUDING BANK INFO
    function inspectWithdrawal(withdrawalKey) {
      console.log('üîç Inspecting withdrawal:', withdrawalKey);
      
      database.ref('withdrawals/' + withdrawalKey).once('value').then(snapshot => {
        const withdrawal = snapshot.val();
        
        console.log('üì¶ Withdrawal data:', withdrawal);
        
        if (!withdrawal) {
          showNotification('error', 'Withdrawal not found');
          return;
        }
        
        const date = new Date(withdrawal.timestamp).toLocaleString();
        const userNumber = generateUserNumber(withdrawal.userId);
        
        // ‚úÖ FIXED: Properly handle bankDetails
        let bankDetailsHTML = '<p style="text-align: center; color: #999; margin-top: 10px;">No bank details available</p>';
        
        if (withdrawal.bankDetails) {
          bankDetailsHTML = `
            <div class="detail-row">
              <span class="detail-label">Account Number:</span>
              <span class="detail-value">${withdrawal.bankDetails.accNumber || 'N/A'}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">IFSC Code:</span>
              <span class="detail-value">${withdrawal.bankDetails.ifsc || 'N/A'}</span>
            </div>
          `;
        }
        
        const modalContent = document.getElementById('withdrawalModalContent');
        modalContent.innerHTML = `
          <div class="detail-row">
            <span class="detail-label">User Number:</span>
            <span class="detail-value" style="font-weight: bold; color: #1e3c72;">#${userNumber}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Withdrawal ID:</span>
            <span class="detail-value">${withdrawal.withdrawalId || 'N/A'}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">User ID:</span>
            <span class="detail-value">${withdrawal.userId || 'N/A'}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Phone:</span>
            <span class="detail-value">${withdrawal.phone || 'N/A'}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Amount:</span>
            <span class="detail-value" style="color: #ff4444; font-weight: bold;">‚Çπ${withdrawal.amount || 0}</span>
          </div>
          ${bankDetailsHTML}
          <div class="detail-row">
            <span class="detail-label">Date & Time:</span>
            <span class="detail-value">${date}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Status:</span>
            <span class="detail-value" style="color: ${withdrawal.status === 'approved' ? '#00a86b' : withdrawal.status === 'rejected' ? '#ff4444' : '#ff9800'}; font-weight: bold;">
              ${withdrawal.status ? withdrawal.status.toUpperCase() : 'UNKNOWN'}
            </span>
          </div>
        `;

        const modalActions = document.getElementById('withdrawalModalActions');
        if (withdrawal.status === 'pending') {
          modalActions.innerHTML = `
            <button class="modal-btn approve-btn" onclick="approveWithdrawalModal('${withdrawalKey}')">
              <i class="fas fa-check"></i> Approve
            </button>
            <button class="modal-btn reject-btn" onclick="rejectWithdrawalModal('${withdrawalKey}')">
              <i class="fas fa-times"></i> Reject
            </button>
          `;
        } else {
          modalActions.innerHTML = '<p style="text-align: center; color: #999;">No actions available</p>';
        }
        
        document.getElementById('withdrawalInspectModal').style.display = 'flex';
        
        console.log('‚úÖ Modal displayed with full details');
      }).catch(error => {
        console.error('‚ùå Error loading withdrawal:', error);
        showNotification('error', 'Failed to load withdrawal details');
      });
    }

    function closeWithdrawalModal() {
      document.getElementById('withdrawalInspectModal').style.display = 'none';
    }

    // ‚úÖ FIXED: approveWithdrawalModal - PROPERLY APPROVES
    function approveWithdrawalModal(withdrawalKey) {
      if (!confirm('Are you sure you want to APPROVE this withdrawal?')) {
        return;
      }
      
      console.log('‚úÖ Approving withdrawal:', withdrawalKey);
      
      database.ref('withdrawals/' + withdrawalKey).once('value').then(snapshot => {
        const withdrawal = snapshot.val();
        
        database.ref('withdrawals/' + withdrawalKey + '/status').set('approved')
          .then(() => {
            showNotification('success', `Withdrawal approved: ‚Çπ${withdrawal.amount}`);
            closeWithdrawalModal();
            loadStats();
          })
          .catch(error => {
            console.error('Error approving withdrawal:', error);
            showNotification('error', 'Failed to approve withdrawal');
          });
      });
    }

    // ‚úÖ FIXED: rejectWithdrawalModal - PROPERLY REJECTS AND REFUNDS
    function rejectWithdrawalModal(withdrawalKey) {
      if (!confirm('Are you sure you want to REJECT and REFUND this withdrawal?')) {
        return;
      }
      
      console.log('‚ùå Rejecting withdrawal:', withdrawalKey);
      
      database.ref('withdrawals/' + withdrawalKey).once('value').then(snapshot => {
        const withdrawal = snapshot.val();
        
        const cleanPhone = withdrawal.phone.replace(/[^0-9]/g, '');
        
        database.ref('users/' + cleanPhone).once('value').then(userSnapshot => {
          const user = userSnapshot.val();
          const newBalance = (user.balance || 0) + withdrawal.amount;
          
          database.ref('users/' + cleanPhone + '/balance').set(newBalance)
            .then(() => {
              return database.ref('withdrawals/' + withdrawalKey + '/status').set('rejected');
            })
            .then(() => {
              showNotification('success', 'Withdrawal rejected and amount refunded');
              closeWithdrawalModal();
              loadStats();
            })
            .catch(error => {
              console.error('Error rejecting withdrawal:', error);
              showNotification('error', 'Failed to reject withdrawal');
            });
        });
      });
    }

    // ‚ö†Ô∏è FIX: DELETE WITHDRAWAL FROM ADMIN
    function deleteWithdrawalAdmin(withdrawalKey) {
      if (confirm("Are you sure you want to delete this withdrawal record?")) {
        database.ref('withdrawals/' + withdrawalKey).remove()
          .then(() => {
            showNotification('success', "Withdrawal record deleted successfully!");
            loadWithdrawals();
          })
          .catch(error => {
            console.error("Error deleting withdrawal:", error);
            showNotification('error', "Failed to delete withdrawal record");
          });
      }
    }

    function loadRecentResults() {
      database.ref('results').orderByChild('timestamp').limitToLast(20).on('value', snapshot => {
        const results = [];
        snapshot.forEach(child => {
          results.unshift(child.val());
        });

        const container = document.getElementById('recentResults');
        container.innerHTML = '';

        if (results.length === 0) {
          container.innerHTML = '<p style="text-align: center; color: #999;">No results yet</p>';
          return;
        }

        results.forEach(result => {
          const item = document.createElement('div');
          item.className = 'result-item';
          const date = new Date(result.timestamp).toLocaleString();
          item.innerHTML = `
            <div>
              <strong>Period ${result.period.slice(-4)}</strong> - 
              Number: ${result.number}, Size: ${result.size}, Colors: ${result.colors.join(', ')}
            </div>
            <div style="color: #999; font-size: 12px;">${date}</div>
          `;
          container.appendChild(item);
        });
      });
    }

    // Game Control
    function updateGameControl() {
      currentAdminPeriod = generateCurrentPeriod();
      document.getElementById('adminCurrentPeriod').textContent = currentAdminPeriod.slice(-4);
    }

    function startAdminTimer() {
      clearInterval(adminCountdownInterval);
      
      currentAdminPeriod = generateCurrentPeriod();
      adminCountdown = getTimeLeftInPeriod();
      resultPublished = false;
      
      updateGameControl();
      updateAdminTimer();
      
      console.log('[ADMIN] üéÆ Round:', currentAdminPeriod, '| Time left:', adminCountdown);
      
      adminCountdownInterval = setInterval(() => {
        adminCountdown = getTimeLeftInPeriod();
        
        const newPeriod = generateCurrentPeriod();
        if (newPeriod !== currentAdminPeriod) {
          console.log('[ADMIN] üîÑ Period changed');
          clearInterval(adminCountdownInterval);
          waitForAdminResult(currentAdminPeriod);
          return;
        }
        
        updateAdminTimer();
        
        if (adminCountdown <= 0 && !resultPublished) {
          resultPublished = true;
          clearInterval(adminCountdownInterval);
          
          database.ref('results/' + currentAdminPeriod).once('value').then(snapshot => {
            if (!snapshot.exists()) {
              if (gameMode === 'manual' && selectedNumber !== null) {
                publishManualResult();
              } else {
                autoGenerateResult();
              }
            }
            
            setTimeout(() => {
              selectedNumber = null;
              updateSelectedNumberDisplay();
              startAdminTimer();
            }, 1000);
          });
        }
      }, 1000);
    }

    function waitForAdminResult(roundId) {
      let attempts = 0;
      const checkResult = setInterval(() => {
        attempts++;
        
        database.ref('results/' + roundId).once('value').then(snapshot => {
          if (snapshot.exists() || attempts >= 3) {
            clearInterval(checkResult);
            startAdminTimer();
          }
        });
      }, 500);
    }

    function updateAdminTimer() {
      document.getElementById('adminTimeLeft').textContent = adminCountdown + 's';
    }

    function setGameMode(mode) {
      gameMode = mode;
      
      document.getElementById('autoModeBtn').classList.remove('active');
      document.getElementById('manualModeBtn').classList.remove('active');
      
      if (mode === 'auto') {
        document.getElementById('autoModeBtn').classList.add('active');
        document.getElementById('manualControl').classList.add('hidden');
        showNotification('success', 'AUTO MODE: Random results');
      } else {
        document.getElementById('manualModeBtn').classList.add('active');
        document.getElementById('manualControl').classList.remove('hidden');
        showNotification('success', 'MANUAL MODE: Select number');
      }
      
      selectedNumber = null;
      updateSelectedNumberDisplay();
    }

    function selectWinningNumber(number) {
      selectedNumber = number;
      
      document.querySelectorAll('.number-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      event.target.classList.add('selected');
      
      updateSelectedNumberDisplay();
      showNotification('success', `Number ${number} selected`);
    }

    function updateSelectedNumberDisplay() {
      const display = document.getElementById('selectedNumberDisplay');
      const numText = document.getElementById('selectedNumText');
      
      if (selectedNumber !== null) {
        display.style.display = 'block';
        numText.textContent = selectedNumber;
      } else {
        display.style.display = 'none';
        document.querySelectorAll('.number-btn').forEach(btn => {
          btn.classList.remove('selected');
        });
      }
    }

    function publishManualResult() {
      if (selectedNumber === null) {
        autoGenerateResult();
        return;
      }

      const colors = getColorForNumber(selectedNumber);
      const size = selectedNumber >= 5 ? 'big' : 'small';
      
      const result = {
        period: currentAdminPeriod,
        number: selectedNumber,
        size: size,
        colors: colors,
        timestamp: Date.now(),
        source: 'manual'
      };
      
      console.log('[ADMIN] üì§ Manual result:', result);
      
      database.ref('results/' + currentAdminPeriod).set(result)
        .then(() => {
          showNotification('success', `‚úÖ Manual result: ${selectedNumber}`);
        })
        .catch(error => {
          console.error('[ADMIN] ‚ùå Error:', error);
        });
    }

    function autoGenerateResult() {
      const winningNumber = Math.floor(Math.random() * 10);
      const colors = getColorForNumber(winningNumber);
      const size = winningNumber >= 5 ? 'big' : 'small';
      
      const result = {
        period: currentAdminPeriod,
        number: winningNumber,
        size: size,
        colors: colors,
        timestamp: Date.now(),
        source: 'auto'
      };
      
      console.log('[ADMIN] üé≤ Auto result:', result);
      
      database.ref('results/' + currentAdminPeriod).set(result)
        .then(() => {
          showNotification('success', `üé≤ Auto result: ${winningNumber}`);
        });
    }

    function getColorForNumber(number) {
      if (number === 0) return ['red', 'violet'];
      if (number === 5) return ['green', 'violet'];
      if ([1, 3, 7, 9].includes(number)) return ['green'];
      return ['red'];
    }

    function showNotification(type, message) {
      const notification = document.getElementById('notification');
      notification.className = `notification ${type} show`;
      document.getElementById('notificationMessage').textContent = message;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
  </script>
</body>
</html>
